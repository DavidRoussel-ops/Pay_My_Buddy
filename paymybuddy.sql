
SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";

CREATE DATABASE paymybuddy;

USE paymybuddy;

CREATE TABLE USER (
ID int PRIMARY KEY AUTO_INCREMENT NOT NULL,
USERNAME VARCHAR(100) NOT NULL,
EMAIL VARCHAR(255) NOT NULL,
PASSWORD VARCHAR(255) NOT NULL
);

CREATE TABLE TRANSACTION (
ID int PRIMARY KEY AUTO_INCREMENT NOT NULL,
DESCRIPTION VARCHAR(255) NOT NULL,
AMOUNT DOUBLE NOT NULL
);

CREATE TABLE USER_FRIENDS (
ID int PRIMARY KEY AUTO_INCREMENT NOT NULL,
USER_FRIEND_ID int NULL,
FOREIGN KEY (USER_FRIEND_ID)
REFERENCES USER(ID) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (USER_FRIEND_ID));

CREATE TABLE USER_TRANSACTION_RECEIVER (
ID int PRIMARY KEY AUTO_INCREMENT NOT NULL,
USER_ID int NULL,
TRANSACTION_ID int NULL,
FOREIGN KEY(USER_ID)
REFERENCES USER(ID) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY(TRANSACTION_ID)
REFERENCES TRANSACTION(ID) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (USER_ID, TRANSACTION_ID));

CREATE TABLE USER_TRANSACTION_SENDER (
ID int PRIMARY KEY AUTO_INCREMENT NOT NULL,
USER_ID int NULL,
TRANSACTION_ID int ,
FOREIGN KEY(USER_ID)
REFERENCES USER(ID) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY(TRANSACTION_ID)
REFERENCES TRANSACTION(ID) ON DELETE RESTRICT ON UPDATE CASCADE,
PRIMARY KEY (USER_ID, TRANSACTION_ID));

INSERT INTO USER(ID,USERNAME,EMAIL,PASSWORD) VALUES
(1,'Jaques', 'jaques@gmail.com', 'jaquespassword'),
(2,'Pierre', 'pierre@gmail.com', 'pierrepassword'),
(3,'Jean', 'jean@gmail.com', 'jeanpassword'),
(4,'Michel', 'michel@gmail.com', 'michelpassword');

INSERT INTO TRANSACTION(ID,DESCRIPTION, AMOUNT) VALUES
(1,'restaurant', 25),
(2,'magasin', 30),
(3,'note de frais', 50);

INSERT INTO USER_FRIENDS(ID, USER_FRIEND_ID) VALUES
(1, 1),
(2, 2),
(3, 3),
(4, 4);

INSERT INTO USER_TRANSACTION_RECEIVER(ID, USER_ID, TRANSACTION_ID) VALUES
(1, 3, 3),
(2, 1, 1),
(3, 2, 2);

INSERT INTO USER_TRANSACTION_SENDER(ID, USER_ID, TRANSACTION_ID) VALUES
(1, 1, 3),
(2, 2, 1),
(3, 3, 2);

COMMIT;